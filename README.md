
# 🧰 SEU劳动教育课程推送助手使用说明

- 这是一个**篡改猴**脚本，你需要在浏览器安装篡改猴扩展并导入该脚本使用
- 目前已推出 **2.6版本** 完美适配移动端网页，只需在**手机版edge浏览器**安装篡改猴插件和本脚本，你将真正实现日常刷刷网页即可自动获取最新劳动开课信息！！
> 东南大学劳动教育选课神器！  
> 实时监控新增课程并通过Telegram推送通知，无需手动刷新页面！

---

![59c7e38ab23d3d6f0ddc78249d30b215](https://github.com/user-attachments/assets/7bb615b1-1cf9-4bb4-b5b2-6027ce76699c)

---
## ✨ 功能亮点

- **自动打开**：后台标签页自动打开执行，无需人工干预。
- **自动登录**：配置区填写好一次账号密码，脚本自动完成统一身份认证。
- **智能监控**：后台持续检测劳动教育选课页面的新课程。
- **多渠道推送**：支持 Telegram Bot 和企业微信双渠道推送，实时通知新课程信息。
- **状态查询**：支持通过企业微信主动查询脚本运行状态，实时了解心跳情况。
- **校区筛选**：可指定仅接收特定校区（如九龙湖、四牌楼）的课程。
- **防重复推送**：自动记录已推送课程，避免重复提醒。
- **自动刷新 & 活性维持**：即使关闭选课页，也会在后台自动打开并保持运行。

---

## ⚙️ 配置说明

打开脚本，在 **「全局配置区」** 修改以下字段：

```js
const USERNAME = '12345678';       // 替换为你的一卡通号
const PASSWORD = 'abc123456';      // 替换为你的统一身份认证密码
const TELEGRAM_BOT_TOKEN = '8253654589:AAF5h-ip78rBhnt4PTYDhIUQaCRkiC7ZLU4'; // Telegram Bot Token
const TELEGRAM_CHAT_ID = '';       // 替换为你的Telegram Chat ID
const WECHAT_WEBHOOK_URL = '';     // 企业微信机器人Webhook地址（可选）
const WECHAT_CORPID = '';          // 企业微信CorpID（用于主动查询，可选）
const WECHAT_CORPSECRET = '';      // 企业微信应用Secret（用于主动查询，可选）
const WECHAT_AGENTID = '';         // 企业微信应用AgentID（用于主动查询，可选）
const LOCATION_FILTERS = [];       // 校区筛选，例如：['九龙湖校区','四牌楼校区']；留空则不过滤
const CATEGORY_FILTERS = [];       // 劳动类别筛选，如['服务劳动']，为空则不筛选（完全匹配）
```

#### 🔑 获取 Telegram Chat ID 步骤：
1. 在Telegram中搜索并打开 **@seu_laborpusher_bot**
2. 向机器人发送任意消息（例如 `/start`）
3. 访问 `https://api.telegram.org/bot8253654589:AAF5h-ip78rBhnt4PTYDhIUQaCRkiC7ZLU4/getUpdates`
4. 在返回的JSON中找到 `"chat":{"id":xxxxx}` 字段，复制这个数字ID
5. 将该ID填入配置区的 `TELEGRAM_CHAT_ID` 中

> 💡 提示：Telegram Bot 推送完全免费，无需任何付费操作。

#### 📱 配置企业微信推送（可选）：

**方式一：使用企业微信群机器人（简单推送）**
1. 在企业微信群聊中，点击右上角 `...` → 添加群机器人
2. 选择"添加机器人"，创建后复制Webhook地址
3. 将Webhook地址填入配置区的 `WECHAT_WEBHOOK_URL` 中
4. 脚本将自动同时向Telegram和企业微信推送课程信息

**方式二：配置企业微信应用（支持主动查询）**
1. 登录[企业微信管理后台](https://work.weixin.qq.com/)
2. 进入"应用管理" → "自建" → 创建应用
3. 记录应用的 `AgentId` 和 `Secret`
4. 在"我的企业"中找到 `企业ID（CorpID）`
5. 将这些信息分别填入配置区的 `WECHAT_CORPID`、`WECHAT_CORPSECRET`、`WECHAT_AGENTID`
6. 配置完成后，可以通过企业微信应用主动查询脚本运行状态：
   - 通过GM脚本API设置查询请求：`GM_setValue('wechat_query_request', {timestamp: Date.now()})`
   - 脚本将检查心跳状态并回复：
     - 如果最近有心跳（30秒内）：回复"工作正常"
     - 如果超过30秒无心跳：回复"异常"

> 💡 提示：企业微信推送为可选功能，不影响Telegram推送。两种推送方式可以同时使用。

---
> ⚠️ 初次安装脚本时，由于默认全局配置未修改，脚本自动运行后立即进入登录失败冷却期。请修改全局配置变量，并手动登录一次 `https://auth.seu.edu.cn/dist/#/dist/main/login` （统一身份认证页面）以跳出冷却期，并完成首次设备登录的短信验证（如果需要）。随后脚本即开始正常搜索/推送课程。
---

## 🔄 工作流程

1. 脚本在任意网页后台运行，每 60 秒检查是否已有选课页面。
2. 若无活跃页面，自动在后台打开登录页。
3. 自动填写账号密码并登录 → 跳转至劳动教育首页 → 进入选课页。
4. 解析课程表格，筛选 **未满员 + 未截止 + 地点匹配** 的课程。
5. 若发现新课程，立即通过 Telegram Bot 和企业微信推送通知，并记录唯一标识防止重复。
6. 每 3 分钟自动刷新选课页，持续监控。
7. 支持通过企业微信主动查询运行状态，实时掌握脚本工作情况。

---

## 📌 注意事项

- **首次运行建议手动登录一次**，确保账号密码正确且无需短信验证。
- 若系统要求短信验证码，自动登录会失败，此时脚本将暂停登录 15 分钟，并推送告警。
- 课程唯一标识 = `项目名称 + 实施时间`，可有效避免同名课程误判。
- 脚本仅在 `labor.seu.edu.cn` 和 `auth.seu.edu.cn` 相关页面执行核心逻辑，安全可靠。

---

## ⚠️ 已知问题

- 由于浏览器会对后台标签页进行性能限制或挂起（如 Chrome 的 Tab Freezing），先前一些版本脚本的“报活”机制可能失效，尤其是用于移动端浏览器，导致重复打开新的选课标签页。最新版本中通过新的心跳机制，已经基本解决了此问题。

---

## 🛠 调试技巧

- 打开浏览器开发者工具（F12），切换到 **Console** 面板。
- 查看带 `[自动登录]`、`[课程监控]` 等标签的日志，了解运行状态。
- 若推送失败，请检查 Telegram Bot Token 和 Chat ID 是否正确、网络是否通畅。

---

## ❤️ 致谢

- 脚本作者：[@zz6zz666](https://github.com/zz6zz666)
- 辅助开发：豆包，Qwen（通义千问）

---

> 📣 **温馨提示**：请合理使用本工具，遵守学校选课规则，切勿恶意刷课或干扰系统正常运行。

---

